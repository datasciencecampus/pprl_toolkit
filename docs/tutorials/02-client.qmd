---
title: Acting as a data-owning party
tags: [client]
---

This tutorial describes how to go about uploading your data to GCP for linkage
on a confidential server. To do so, you will install and run a Flask app that
provides a graphical user interface (GUI) for uploading data.

::: {.callout-important}
You will only be able to upload your data if the cloud infrastructure has been
[set up](01-setup-server.qmd) by the administrator of your linkage project.
You do not need to go through that process if you are not the administrator.
:::


## Setting yourself up

### Receiving your credentials

In order to be able to upload your data to GCP, you will need a set of
credentials for a service account. This account and the credentials were
created by your linkage administrator when setting up the confidential server.
It is their responsibility to share the credentials with you, so reach out if
you have not yet received them.

The credentials file comes in JSON format and should be named
`party-<party-number>-service-account-credentials.json`, where `<party-number>`
indicates which party you are in the linkage (one or two). The contents of the
file should look something like this:

```json
{
  "type": "service_account",
  "project_id": "<PROJECT NAME>",
  "private_key_id": "<PRIVATE KEY ID>",
  "private_key": "<PRIVATE KEY>",
  "client_email": "party-<1,2>-service-account@<PROJECT NAME>.iam.gserviceaccount.com",
  "client_id": "<CLIENT ID>",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/party-<1,2>-service-account%40<PROJECT NAME>.iam.gserviceaccount.com",
  "universe_domain": "googleapis.com"
}
```

Once you have received your credentials file, put it somewhere safe and
accessible on your machine. We recommend the `secrets/` directory at the root
directory of the `pprl` repository.

### Environment variables

Regardless of where you've stored the credentials file, you now need to let
`pprl` know where it is by storing its path as an environment variable.

To avoid exposing your credentials elsewhere, or bloating your system
environment, we recommend you add the path to a hidden environment file called
`.env`. If you have not yet created one, you can do so by running this command:

```bash
touch .env
```

::: {.callout-tip}
If you're on Windows, use this command instead:

```ps
echo. > .env
```
:::

You should then add the following line to the `.env` file, replacing the path
and file name as needed:

```shell
GOOGLE_APPLICATION_CREDENTIALS=/path/to/party-<1,2>-service-account-credentials.json
```


## Running the app

You should be all set up now to run the app and upload your data.

::: {.callout-important}
You will also need two important things:

1. Your dataset to be linked with at least sex, name, and DOB columns
2. A _salt_ string that is secret and agreed between you and the other linkage
   party
:::

From the root directory of this project, run the following command:

```bash
python -m flask --app src/pprl/app/app run
```

This should provide a URL to a local host server like `https://127.0.0.1:5000`.
Open the URL in your browser and you will be in the GUI, pictured below.

![A screenshot of the app](_static/02-client-screenshot.png)

From here, the process to upload your data is as follows:

1. Click `Choose file` to open your file browser
2. Navigate to and select your dataset
3. Click `Submit`
4. Assign types to each column in your dataset
5. Enter the agreed salt
6. Click `Upload file to GCP`

:::{.callout-tip}
If you don't want to upload the data to GCP for linkage, you can choose to
download the processed data instead by clicking `Download file locally`.

This downloads the bloom filters of your data without performing any matching
or linkage in the cloud.
:::

Once both parties have uploaded their datasets, your linkage administrator can
execute the [linkage process](03-run-server.qmd). Upon completion, your results
will be available to download and your linkage will be complete.
